---
source: "Engine::ValidationDeduplicationTest#test_0002_multiple identical errors at different locations generate separate templates"
input: "{source: \"<div <%= @bad1 %>></div>\\n<div <%= @bad1 %>></div>\\n<div <%= @bad2 %>></div>\\n\", options: {validation_mode: :overlay, filename: \"multi_test.html.erb\"}}"
---
_buf = ::String.new; _buf << '<div '.freeze; _buf << (@bad1).to_s; _buf << '></div>
<div '.freeze; _buf << (@bad1).to_s; _buf << '></div>
<div '.freeze; _buf << (@bad2).to_s; _buf << '></div>
'.freeze; _buf << ('<template
  data-herb-validation-error
  data-severity="error"
  data-source="SecurityValidator"
  data-code="SecurityViolation"
  data-line="1"
  data-column="5"
  data-filename="multi_test.html.erb"
  data-message="ERB output tags (&lt;%= %&gt;) are not allowed in attribute position."
  data-suggestion="Use control flow (&lt;% %&gt;) with static attributes instead."
  data-timestamp="2025-01-01T12:00:00Z"
><div class="herb-validation-item" data-severity="error">
  <div class="herb-validation-header">
    <span class="herb-validation-badge" style="background: #dc2626">
      Security
    </span>
    <span class="herb-validation-location">
      multi_test.html.erb:1:5
    </span>
  </div>
  <div class="herb-validation-message" style="color: #dc2626">
    ERB output tags (&lt;%= %&gt;) are not allowed in attribute position.
  </div>
  <div class="herb-code-snippet">
  <div class="herb-code-line herb-error-line">
  <div class="herb-line-number">1</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad1 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-error-pointer">    ^</div>
<div class="herb-code-line">
  <div class="herb-line-number">2</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad1 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-code-line">
  <div class="herb-line-number">3</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad2 %&gt;&gt;&lt;/div&gt;</div>
</div>

</div>

  <div class="herb-validation-suggestion">
  <span class="herb-suggestion-icon">ðŸ’¡</span>
  Use control flow (&lt;% %&gt;) with static attributes instead.
</div>

</div>
</template>
<template
  data-herb-validation-error
  data-severity="error"
  data-source="SecurityValidator"
  data-code="SecurityViolation"
  data-line="2"
  data-column="5"
  data-filename="multi_test.html.erb"
  data-message="ERB output tags (&lt;%= %&gt;) are not allowed in attribute position."
  data-suggestion="Use control flow (&lt;% %&gt;) with static attributes instead."
  data-timestamp="2025-01-01T12:00:00Z"
><div class="herb-validation-item" data-severity="error">
  <div class="herb-validation-header">
    <span class="herb-validation-badge" style="background: #dc2626">
      Security
    </span>
    <span class="herb-validation-location">
      multi_test.html.erb:2:5
    </span>
  </div>
  <div class="herb-validation-message" style="color: #dc2626">
    ERB output tags (&lt;%= %&gt;) are not allowed in attribute position.
  </div>
  <div class="herb-code-snippet">
  <div class="herb-code-line">
  <div class="herb-line-number">1</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad1 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-code-line herb-error-line">
  <div class="herb-line-number">2</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad1 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-error-pointer">    ^</div>
<div class="herb-code-line">
  <div class="herb-line-number">3</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad2 %&gt;&gt;&lt;/div&gt;</div>
</div>

</div>

  <div class="herb-validation-suggestion">
  <span class="herb-suggestion-icon">ðŸ’¡</span>
  Use control flow (&lt;% %&gt;) with static attributes instead.
</div>

</div>
</template>
<template
  data-herb-validation-error
  data-severity="error"
  data-source="SecurityValidator"
  data-code="SecurityViolation"
  data-line="3"
  data-column="5"
  data-filename="multi_test.html.erb"
  data-message="ERB output tags (&lt;%= %&gt;) are not allowed in attribute position."
  data-suggestion="Use control flow (&lt;% %&gt;) with static attributes instead."
  data-timestamp="2025-01-01T12:00:00Z"
><div class="herb-validation-item" data-severity="error">
  <div class="herb-validation-header">
    <span class="herb-validation-badge" style="background: #dc2626">
      Security
    </span>
    <span class="herb-validation-location">
      multi_test.html.erb:3:5
    </span>
  </div>
  <div class="herb-validation-message" style="color: #dc2626">
    ERB output tags (&lt;%= %&gt;) are not allowed in attribute position.
  </div>
  <div class="herb-code-snippet">
  <div class="herb-code-line">
  <div class="herb-line-number">1</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad1 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-code-line">
  <div class="herb-line-number">2</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad1 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-code-line herb-error-line">
  <div class="herb-line-number">3</div>
  <div class="herb-line-content">&lt;div &lt;%= @bad2 %&gt;&gt;&lt;/div&gt;</div>
</div>
<div class="herb-error-pointer">    ^</div>

</div>

  <div class="herb-validation-suggestion">
  <span class="herb-suggestion-icon">ðŸ’¡</span>
  Use control flow (&lt;% %&gt;) with static attributes instead.
</div>

</div>
</template>
<template data-herb-validation-llm-prompt data-default-view="human"># ERB Template Validation Issues&#10;&#10;Herb, an HTML-aware ERB validation tool, detected 3 issues in an ERB template that should be addressed.&#10;&#10;## Files&#10;- `multi_test.html.erb`&#10;&#10;## Issues&#10;&#10;### Issue 1: Security Error&#10;&#10;**File:** `multi_test.html.erb`&#10;&#10;**Location:** Line 1, Column 5&#10;&#10;**Message:** ERB output tags (&lt;%= %&gt;) are not allowed in attribute position.&#10;&#10;**Suggestion:** Use control flow (&lt;% %&gt;) with static attributes instead.&#10;&#10;### Issue 2: Security Error&#10;&#10;**File:** `multi_test.html.erb`&#10;&#10;**Location:** Line 2, Column 5&#10;&#10;**Message:** ERB output tags (&lt;%= %&gt;) are not allowed in attribute position.&#10;&#10;**Suggestion:** Use control flow (&lt;% %&gt;) with static attributes instead.&#10;&#10;### Issue 3: Security Error&#10;&#10;**File:** `multi_test.html.erb`&#10;&#10;**Location:** Line 3, Column 5&#10;&#10;**Message:** ERB output tags (&lt;%= %&gt;) are not allowed in attribute position.&#10;&#10;**Suggestion:** Use control flow (&lt;% %&gt;) with static attributes instead.&#10;&#10;## Instructions&#10;&#10;Please review and fix the validation issues listed above.&#10;&#10;When fixing these issues, ensure that:&#10;1. Security best practices are followed&#10;2. HTML structure follows proper nesting rules&#10;3. Code duplication resulting from the fixes is kept to a minimum. Making use of methods (either View Component methods, helper methods, inline methods, etc.), HTML builder helper methods (ie: content_tag, etc.), procs, etc, if it means keeping the resulting code clean, readable and maintainable.&#10;&#10;Provide correct the ERB template code for each affected file.&#10;</template>'.html_safe).to_s;
_buf.to_s
