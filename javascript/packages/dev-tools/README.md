# @herb-tools/dev-tools

Development tools for visual ERB debugging in Herb templates. Provides a browser-based interface for inspecting ERB expressions, template boundaries, and debugging information.

## Features

- **Visual ERB Debugging**: Show ERB expressions and their output directly in the browser
- **Template Boundaries**: Highlight view and partial boundaries with interactive labels
- **Interactive Tooltips**: Click-to-open files in your editor with line/column precision
- **Zero Configuration**: Auto-detects debug markup and initializes automatically
- **Non-disruptive**: Uses `display: contents` and careful positioning to maintain page layout

## Installation

```bash
npm install @herb-tools/dev-tools
# or
yarn add @herb-tools/dev-tools
```

## Usage

### Automatic Initialization

The dev tools automatically initialize when debug markup is detected on the page:

```html
<!-- This will trigger auto-initialization -->
<span class="erb-value erb-outlined-hover" 
      data-herb-debug-erb="<%= @user.name %>"
      data-herb-debug-file="users/show.html.erb"
      data-herb-debug-line="5"
      data-herb-debug-column="12">
  John Doe
</span>
```

### Manual Initialization

```javascript
import { initHerbDevTools } from '@herb-tools/dev-tools';

// Initialize with default options
const overlay = initHerbDevTools();

// Initialize with custom options
const overlay = initHerbDevTools({
  projectPath: '/path/to/your/project',
  autoInit: true
});
```

### Direct API Usage

```javascript
import { HerbOverlay, StyleInjector } from '@herb-tools/dev-tools';

// Inject styles manually
StyleInjector.inject();

// Create overlay instance
const overlay = new HerbOverlay({
  projectPath: '/path/to/your/project'
});
```

## Rails Integration

When using with Rails and ReactionView, the debug markup is automatically generated in development mode:

```ruby
# config/initializers/reactionview.rb
ReactionView.configure do |config|
  config.enable_debug_mode = Rails.env.development?
end
```

## Browser Integration

The tools provide a floating menu in the top-right corner with toggles for:

- **Show View Outlines**: Highlight template boundaries
- **Show Partial Outlines**: Highlight partial boundaries  
- **Show ERB Output Outlines**: Show dotted outlines around ERB expressions
- **Show ERB Output Tags**: Replace output with ERB source code
- **Disable All**: Quick way to hide all debugging features

## Editor Integration

Clicking on file labels or ERB tooltips will attempt to open files in your editor:

- VS Code: `vscode://file/path:line:column`
- Sublime Text: `subl://open?url=file://path&line=line&column=column`
- Atom: `atom://core/open/file?filename=path&line=line&column=column`
- TextMate: `txmt://open?url=file://path&line=line&column=column`

## API Reference

### HerbOverlay

Main class for managing the debugging interface.

```typescript
interface HerbDevToolsOptions {
  projectPath?: string;  // Base path for opening files in editor
  autoInit?: boolean;    // Whether to auto-initialize (default: true)
}

class HerbOverlay {
  constructor(options: HerbDevToolsOptions = {})
  
  // Public methods
  highlightERBElement(selector: string, type: 'outline' | 'hover' | 'value'): void
  showFileOutline(element: HTMLElement, fileName: string): void
  createERBTooltip(element: HTMLElement, erbCode: string): void
}
```

### StyleInjector

Utility for injecting the required CSS styles.

```typescript
class StyleInjector {
  static inject(): void        // Inject styles into document head
  static remove(): void        // Remove injected styles
  static isInjected(): boolean // Check if styles are injected
}
```

## CSS Classes

The dev tools work with the following CSS classes generated by Herb's debug mode:

- `.erb-value, .erb-outlined-hover`: ERB expression containers
- `.view-outline`: View template boundaries
- `.partial-outline`: Partial template boundaries
- `.overlay-label`: File name labels

## Data Attributes

Debug information is stored in data attributes:

- `data-herb-debug-erb`: Original ERB expression
- `data-herb-debug-file`: Source filename
- `data-herb-debug-line`: Line number
- `data-herb-debug-column`: Column number
- `data-herb-debug-full-path`: Full file path
- `data-herb-debug-view-path`: Rails view path

## License

MIT