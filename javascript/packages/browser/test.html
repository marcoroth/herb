<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herb WASM Test</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      textarea {
        width: 100%;
        height: 150px;
        margin-bottom: 10px;
      }

      .output {
        white-space: pre-wrap;
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
      }

      button {
        margin-right: 10px;
        padding: 8px 16px;
      }
    </style>
  </head>

  <body>
    <h1>Herb WASM Test</h1>

    <h2>Version Info</h2>
    <div id="version-info" class="output">Loading...</div>

    <h2>Test Input</h2>
    <textarea id="code-input"><div class="container">
    <% @users.each do |user| %>
      <div class="user">
        <h3><%= user.name %></h3>
        <p><%= user.bio %></p>
      </div>
    <% end %>
  </div></textarea>

    <div>
      <button id="parse-btn">Parse</button>
      <button id="lex-btn">Lex</button>
      <button id="extract-ruby-btn">Extract Ruby</button>
      <button id="extract-html-btn">Extract HTML</button>
    </div>

    <h2>Output</h2>
    <div id="output" class="output">Run an operation to see results</div>

    <script type="module">
      import {
        Herb
      } from './dist/herb-browser.esm.js';


      try {
        const versionInfo = await Herb.version();
        document.getElementById('version-info').textContent = `Herb Version: ${versionInfo}`;
      } catch (error) {
        document.getElementById('version-info').textContent = `Error loading Herb: ${error.message}`;
        console.error('Version error:', error);
      }

      document.getElementById('parse-btn').addEventListener('click', async () => {
        try {
          const source = document.getElementById('code-input').value;
          const result = await Herb.parse(source);
          document.getElementById('output').textContent = JSON.stringify(JSON.parse(result), null, 2);
        } catch (error) {
          document.getElementById('output').textContent = `Parse error: ${error.message}`;
          console.error('Parse error:', error);
        }
      });

      document.getElementById('lex-btn').addEventListener('click', async () => {
        try {
          const source = document.getElementById('code-input').value;
          const result = await Herb.lex(source);
          document.getElementById('output').textContent = JSON.stringify(JSON.parse(result), null, 2);
        } catch (error) {
          document.getElementById('output').textContent = `Lex error: ${error.message}`;
          console.error('Lex error:', error);
        }
      });

      document.getElementById('extract-ruby-btn').addEventListener('click', async () => {
        try {
          const source = document.getElementById('code-input').value;
          const result = await Herb.extractRuby(source);
          document.getElementById('output').textContent = result;
        } catch (error) {
          document.getElementById('output').textContent = `Extract Ruby error: ${error.message}`;
          console.error('Extract Ruby error:', error);
        }
      });

      document.getElementById('extract-html-btn').addEventListener('click', async () => {
        try {
          const source = document.getElementById('code-input').value;
          const result = await Herb.extractHtml(source);
          document.getElementById('output').textContent = result;
        } catch (error) {
          document.getElementById('output').textContent = `Extract HTML error: ${error.message}`;
          console.error('Extract HTML error:', error);
        }
      });
    </script>
  </body>
</html>
